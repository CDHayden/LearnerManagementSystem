{% extends '/student/studentbase.html' %}

{% block content %}
<div class="row">

    <!-- PAGE HEADER -->
    <div class="col-12 design-mode">
        <p><strong> {{student.forename}}'s classes </strong></p>
    </div>
    <!-- ./ PAGE HEADER -->

    <!-- SIDE MENU -->
    <div id="sidemenu" class="col-12 col-sm-4">
        {% for item in menu_items %}
        <div class="card">
            <div class="card-header text-center">
                <button class="btn btn-link" id="heading{{loop.index}}" data-toggle="collapse"
                    data-target="#collapse{{loop.index}}" aria-expanded="true" aria-controls="collapse{{loop.index}}">
                    <h5>{{item}}</h5>
                </button>

            </div>
            <div id="collapse{{loop.index}}" class="card-body collapse show" aria-labelledby="heading{{loop.index}}">
                <ul>
                    {% if menu_items[item] | length > 1 %}
                    <li><a href="{{item}}" class="class-content-link"> {{item}} summary </a></li>
                    {% endif %}

                    {% for link in menu_items[item] %}
                    <li><a href="{{item}}" class="class-content-link"> {{link}} </a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>
    <!-- ./SIDE MENU-->

    <!-- MAIN CONTENT-->
    <div class="col-12 col-sm-8" id="classContent">
    </div>
    <!-- ./MAIN CONTENT -->
</div>

{% endblock %}


{% block late_optional_includes %}
<script>
    $(document).ready(function () {
        selectActiveMenuItem('classesLink', 'active');
    });

    /*
    * When a hyperlink with .class-content-link is clicked
    */
    $(function () {
        $('a.class-content-link').bind('click', function () {

            let clicked_elem = $(this)
            let clicked_class = clicked_elem.text().trim();

            $('#classContent').empty();

            //If the text from the link clicked includes summary
            //Load the subject overview
            if (clicked_class.split(" ").includes("summary")) {
                $.getJSON('/student/_load_subject_content', {
                    subject: clicked_class.split(" ")[0]
                }, function (data) {
                    let subjectName = $("<h4></h4>").text(clicked_elem.attr('href'));
                    let totalClasses = $("<p id='totalClasses'></p>").text(data.grades.length);
                    let averageGrade = $("<p id='averageGrade'></p>").text(data.average_grade);

                    $('#classContent').append(subjectName,
                        totalClasses,
                        averageGrade);
                });
            }
            //Otherwise load in class overview
            else {
                $.getJSON('/student/_load_class_content', {
                    selected_class: clicked_class
                }, function (data) {
                    let subjectName = $("<h4></h4>").text(clicked_elem.attr('href'));
                    let className = $("<h5></h5>").text(data.class_name);
                    let classGrade = $("<p id='classGrade'></p>").text(data.grade);
                    let classStartTime = $("<p id='classStartTime'></p>").text(data.start_time);
                    let classEndTime = $("<p id='classEndTime'></p>").text(data.finish_time);
                    let classAttendance = $("<p id='classAttendance'></p>").text(data.attendance);

                    $('#classContent').append(subjectName,
                        className,
                        classGrade,
                        classStartTime,
                        classEndTime,
                        classAttendance)
                });
            }

            return false;
        });
    });
</script>
{% endblock %}